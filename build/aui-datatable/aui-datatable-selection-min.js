AUI.add("aui-datatable-selection",function(r){var e=r.Lang,n=e.isArray,p=e.isString,l=e.isObject,u="CLASS_NAMES_SELECTION",i="activeCell",k="activeCellChange",c="activeRow",w="boundingBox",h="cell",d="cellIndex",f="children",o="focused",b="key",j="mousedown",t="mouseenter",g="mouseup",m="render",s="selection",v=".",q=function(z,y,x){return Math.min(Math.max(z,y),x);};var a=function(){};a.ATTRS={activeCell:{setter:"getCell"},activeRow:{setter:"getRow"},selection:{setter:"_setSelection"},tabIndex:{value:0}};r.mix(a.prototype,{_capturing:false,_selectionEnd:null,_selectionSeed:null,_selectionStart:null,initializer:function(){var x=this,y=x.get(w);x[u]={cell:x.getClassName(h),selection:x.getClassName(s)};x._bindSelectionUI();y.addClass(x[u].selection);},destroy:function(){var x=this;x._selectionKeyHandler.detach();},captureSelection:function(B){var D=this,E=[],A=[],x=[],F=[],y;for(y=0;y<B.length;y++){var z=B[y],C=D.getCell(z);F.push(z[0]);E.push(C);A.push(D.getColumn(C));}F=r.Array.unique(F);A=r.Array.unique(A);for(y=0;y<F.length;y++){F[y]=D.getRow(F[y]);x[y]=D.getRecord(F[y]);}return{cells:E,cols:A,coords:B,records:x,rows:F};},getCoord:function(z){var y=this,x=y.getCell(z),A=y.body.tbodyNode,B=A.get("firstChild.rowIndex");return[x.get("parentNode.rowIndex")-B,x.get(d)];},_afterActiveCellChange:function(y){var x=this;x.set(c,y.newVal);},_afterRender:function(y){var x=this;x.set(c,x.get(i));},_bindSelectionUI:function(){var x=this,y=x[u];x._selectionKeyHandler=r.getDoc().on(b,r.bind(x._onSelectionKey,x),"down:37,38,39,40");x.after(m,x._afterRender);x.after(k,x._afterActiveCellChange);x.delegate(g,r.bind(x._onSelectionMouseUp,x),v+y.cell);x.delegate(j,r.bind(x._onSelectionMouseDown,x),v+y.cell);x.delegate(t,r.bind(x._onSelectionMouseEnter,x),v+y.cell);},_onSelectionMouseDown:function(A){var x=this,y=A.currentTarget,z=x.get(w);z.unselectable();x._capturing=true;x._selectionSeed=y;x._selectionStart=x._selectionEnd=x.getCoord(y);x.set(i,y);},_onSelectionMouseEnter:function(z){var x=this,y=z.currentTarget;if(!x._capturing){return;}x._selectionSeed=y;x._selectionEnd=x.getCoord(y);x.set(s,{start:x._selectionStart,end:x._selectionEnd});},_onSelectionMouseUp:function(z){var x=this,y=x.get(w);if(x.get(o)){x._selectionEnd=x.getCoord(x._selectionSeed);x.set(s,{start:x._selectionStart,end:x._selectionEnd});}y.selectable();x._capturing=false;},_onSelectionKey:function(y){var F=this,E=F.body,D=E.tbodyNode,G=y.keyCode,A=F.get(i),H,z=D.get(f).size(),x=E.get("columns").length,C,B;if(A&&F.get(o)){H=F.getCoord(A);C=H[0];B=H[1];if(G===37){B--;}else{if(G===38){C--;}else{if(G===39){B++;}else{if(G===40){C++;}}}}C=q(C,0,z-1);B=q(B,0,x-1);F.set(i,[C,B]);F.set(s,[C,B]);y.preventDefault();}},_parseRange:function(C){var A=C[0],z=C[1],B=[],y,x;for(y=Math.min(A[0],z[0]);y<=Math.max(A[0],z[0]);y++){for(x=Math.min(A[1],z[1]);x<=Math.max(A[1],z[1]);x++){B.push([y,x]);}}return B;},_setSelection:function(y){var x=this;if(n(y)){if(!n(y[0])){y=[y];}}else{if(l(y)){y=x._parseRange([y.start,y.end]);}else{if(r.instanceOf(y,r.Node)){y=[x.getCoord(y)];}}}return x.captureSelection(y);}});r.DataTable.Selection=a;r.Base.mix(r.DataTable,[a]);r.DataTable.prototype.getColumn=(function(x){return function(z){var y;if(r.instanceOf(z,r.Node)){y=this.getCell(z);z=y&&(y.get("className").match(new RegExp(this.getClassName("col","(\\w+)")))||[])[1];}return x.call(this,z);};}(r.DataTable.prototype.getColumn));r.DataTable.prototype.getRow=(function(x){return function(z){var y=this,A=y.body.tbodyNode,B;if(r.instanceOf(z,r.Node)){B=z.ancestor(function(C){return C.get("parentNode").compareTo(A);},true);return B;}else{return x.call(this,z);}};}(r.DataTable.prototype.getRow));r.DataTable.prototype._setColumns=function(y){var D={},E=[],A=[],B=r.Array.indexOf,z=r.Lang.isArray;function F(J){var K={},H,I,G;E.push(J);A.push(K);for(H in J){if(J.hasOwnProperty(H)){I=J[H];if(z(I)){K[H]=I.slice();}else{if(l(I,true)&&I.constructor===K.constructor){G=B(I,E);K[H]=G===-1?F(I):A[G];}else{K[H]=J[H];}}}}return K;}function C(G){G=G.replace(/\s+/,"-");if(D[G]){G+=(D[G]++);}else{D[G]=1;}return G;}function x(M,L){var K=[],J,G,H,I;for(J=0,G=M.length;J<G;++J){K[J]=H=p(M[J])?{key:M[J]}:F(M[J]);I=r.stamp(H);if(!H.id){H.id=I;}if(H.field){H.name=H.field;}if(L){H._parent=L;}else{delete H._parent;}H._id=C(H.name||H.key||H.id);if(z(H.children)){H.children=x(H.children,H);}}return K;}return y&&x(y);};},"@VERSION@",{skinnable:true,requires:["datatable-base"]});