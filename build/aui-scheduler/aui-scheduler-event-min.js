AUI.add("aui-scheduler-event",function(aF){var ak=aF.Lang,bb=ak.isString,e=ak.isDate,a2=ak.isFunction,G=ak.isObject,a5=ak.isBoolean,Z=ak.isNumber,aR=aF.ColorUtil,i=aF.DataType.DateMath,aY=aF.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),a7="-",s="&ndash;",at=".",o="",p=" ",k="_",aH="_propagateSet",N="activeView",aD="borderStyle",bi="borderWidth",H="Change",aW="color",aP="colorBrightnessFactor",a6="colorSaturationFactor",aB="content",ad="contentNode",u="disabled",aT="duration",aJ="endDate",bc="events",ap="hidden",ao="icon",U="icons",aU="id",aQ="isoTime",bh="locale",aS="never",m="node",g="overlay",aG="parentEvent",bm="recorder",aI="repeat",ba="repeated",a4="repeater",M="repeatedEvents",ac="scheduler",aq="scheduler-event",ar="scheduler-event-recorder",be="startDate",a0="template",aO="title",d="titleDateFormat",F="titleNode",al="visible",c="%H:%M",aZ="%I:%M",D=aF.getClassName,j=D(ao),r=D(aq),aK=D(aq,aB),z=D(aq,ap),a9=D(aq,u),am=D(aq,bm),ax=D(aq,ba),aj=D(aq,a4),C=D(aq,aO),bg=D(aq,U);CSS_SCHEDULER_EVENT_ICON_DISABLED=D(aq,ao,u),CSS_SCHEDULER_EVENT_ICON_REPEATED=D(aq,ao,ba),CSS_SCHEDULER_EVENT_ICON_REPEATER=D(aq,ao,a4);var R=aF.Component.create({NAME:aq,ATTRS:{borderStyle:{value:"solid",validator:bb},borderWidth:{value:"1px",validator:bb},colorBrightnessFactor:{value:0.75,validator:Z},colorSaturationFactor:{value:1.5,validator:Z},content:{value:"(no title)",validator:bb},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bb},titleDateFormat:{getter:"_getTitleDateFormat",validator:bb},endDate:{valueFn:function(){var A=i.clone(this.get(be));A.setHours(A.getHours()+1);return A;},validator:e},columnNode:{setter:aF.one},disabled:{value:false,validator:a5},node:{valueFn:function(){return aF.Node.create(this.EVENT_NODE_TEMPLATE).setData(aq,this);},setter:aF.one},parentEvent:{},repeat:{setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{valueFn:function(){return new Date();},validator:e},visible:{value:true,validator:a5}},EXTENDS:aF.Base,PROPAGATE_ATTRS:[be,aJ,aB,aW,aP,a6,aD,bi,d,al,u],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+r+'">'+'<div class="'+C+'"></div>'+'<div class="'+aK+'"></div>'+'<div class="'+bg+'">'+'<span class="'+[j,CSS_SCHEDULER_EVENT_ICON_REPEATED].join(p)+'"></span>'+'<span class="'+[j,CSS_SCHEDULER_EVENT_ICON_REPEATER].join(p)+'"></span>'+'<span class="'+[j,CSS_SCHEDULER_EVENT_ICON_DISABLED].join(p)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var L=A.get(m);A.eventStack={};A.nodeStack={};aF.Array.each(aF.SchedulerEvent.PROPAGATE_ATTRS,function(X){A.after(X+H,A._propagateAttrChange);});A._bindUIAttrs();A.contentNode=L.one(at+aK);A.titleNode=L.one(at+C);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A.eventStack={};A.get(m).remove(true);},copyDates:function(L){var A=this;A.set(aJ,i.clone(L.get(aJ)));A.set(be,i.clone(L.get(be)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aF.Array.each(aF.SchedulerEvent.PROPAGATE_ATTRS,function(Y){if(!(Y in (X||{}))){var br=L.get(Y);if(!G(br)){A.set(Y,br);}}});},getBorderColor:function(){var A=this;return A.borderColorRGB.hex;},getDaysDuration:function(){var A=this;return i.getDayOffset(A.get(aJ),A.get(be));},getHoursDuration:function(){var A=this;return i.getHoursOffset(A.get(aJ),A.get(be));},getMinutesDuration:function(){var A=this;return i.getMinutesOffset(A.get(aJ),A.get(be));},getSecondsDuration:function(){var A=this;return i.getSecondsOffset(A.get(aJ),A.get(be));},sameEndDate:function(L){var A=this;return i.compare(A.get(aJ),L.get(aJ));},sameStartDate:function(L){var A=this;return i.compare(A.get(be),L.get(be));},isAfter:function(Y){var X=this;var L=X.get(be);var A=Y.get(be);return i.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(be);var A=Y.get(be);return i.before(L,A);},repeatByDate:function(X){var A=this;var Y=A.uidByDate(X);if(!A.eventStack[Y]){var L=i.clone(X);var br=i.clone(X);i.copyHours(L,A.get(be));i.copyHours(br,A.get(aJ));var bs=new aF.SchedulerEvent({endDate:br,parentEvent:A,scheduler:A.get(ac),startDate:L});bs.copyPropagateAttrValues(A);A.eventStack[Y]=bs;}return A.eventStack[Y];},intersects:function(Y){var X=this;var br=X.get(aJ);var L=X.get(be);var A=Y.get(be);return(X.sameStartDate(Y)||i.between(A,L,br));},intersectHours:function(X){var L=this;var br=L.get(aJ);var A=L.get(be);var Y=i.clone(A);i.copyHours(Y,X.get(be));return(i.compare(A,Y)||i.between(Y,A,br));},isDayOverlapEvent:function(){var A=this;return i.isDayOverlap(A.get(be),A.get(aJ));},isRepeatableDate:function(L){var A=this;var X=A.get(aI);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return i.safeClearTime(A.get(aJ));},getClearStartDate:function(){var A=this;return i.safeClearTime(A.get(be));},uidByDate:function(L){var A=this;L=e(L)?i.safeClearTime(L):A.getClearStartDate();return[aq,L.getTime()].join(k);},setContent:function(X,L){var A=this;A._setContent(ad,X,L);},setTitle:function(X,L){var A=this;A._setContent(F,X,L);},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var X=A.get(m);var Y=A.getBorderColor();if(X){X.setStyles({borderWidth:A.get(bi),borderColor:Y,backgroundColor:A.get(aW),borderStyle:A.get(aD)});}if(A.titleNode){A.titleNode.setStyles({backgroundColor:Y});}if(L){A.eachRepeatedEvent(function(br,bs){br.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aB),L);},syncNodeTitleUI:function(L){var A=this;var X=A._formatDate(A.get(be));var Y=A._formatDate(A.get(aJ));A.setTitle([X,Y].join(p+s+p),L);},eachRepeatedEvent:function(L){var A=this;aF.each(A.eventStack,L,A);},unlink:function(){var A=this;if(A.get(aG)){A.set(aG,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A.eventStack={};A.syncNodeUI();},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterVisibleChange:function(L){var A=this;
A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after("disabledChange",A._afterDisabledChange);A.after("visibleChange",A._afterVisibleChange);A.after("parentEventChange",A._afterParentEventChange);A.after("repeatChange",A._afterRepeatChange);A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(br,bs){var bt=br[aH+aY(X)];if(bt){bt.apply(A,[br,X,L]);}else{br.set(X,Y.newVal);}br.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=i.clone(A.get(aJ));i.copyHours(X,Y);A.set(aJ,X);},_propagateSetStartDate:function(L,X,Y){var A=i.clone(L.get(be));i.copyHours(A,Y);L.set(be,A);},_setColor:function(L){var A=this;A.hsbColor=aR.rgb2hsb(aR.getRGB(L));A.borderColor=aF.clone(A.hsbColor);A.borderColor.b*=A.get(aP);A.borderColor.s*=A.get(a6);A.borderColorRGB=aR.hsb2rgb(A.borderColor);return L;},_setContent:function(X,br,L){var A=this;var Y=A[X];if(Y){Y.setContent(br);}if(L){A.eachRepeatedEvent(function(bs,bt){bs[X].setContent(br);});}},_setRepeat:function(L){var A=this;if(bb(L)){L=aF.SchedulerEventRepeat[L];}return G(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(ac);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(u));A._uiSetVisible(A.get(al));A._uiSetParentEvent(A.get(aG));A._uiSetRepeat(A.get(aI));},_formatDate:function(X,Y){var L=this;var A=L.get(bh);Y=Y||L.get(d);return aF.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(X){var A=this;if(!bb(X)){var L=A.get(ac);X=(L&&L.get(N).get(aQ))?c:aZ;}return X;},_uiSetDisabled:function(L){var A=this;A.get(m).toggleClass(a9,!!L);},_uiSetParentEvent:function(L){var A=this;A.get(m).toggleClass(ax,!!L);},_uiSetRepeat:function(L){var A=this;A.get(m).toggleClass(aj,!!L&&L!==aF.SchedulerEventRepeat[aS]);},_uiSetVisible:function(L){var A=this;A.get(m).toggleClass(z,!L);}}});aF.SchedulerEvent=R;aF.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aJ);var A=L.get(be);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return i.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return i.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return i.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aJ);var A=L.get(be);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aJ);var A=L.get(be);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var au=aF.Lang,a=au.isArray,G=au.isObject,N="activeView",b="arrow",aN="body",aw="bodyContent",n="boundingBox",av="cancel",aV="click",aB="content",aM="date",aC="dateFormat",ag="delete",a3="description",O="edit",bl="event",y="footerContent",aA="form",x="header",t="hide",aQ="isoTime",m="node",g="overlay",P="overlayOffset",bm="recorder",bj="rendered",aI="repeat",aX="save",ac="scheduler",l="schedulerChange",aq="scheduler-event",ar="scheduler-event-recorder",az="shadow",ay="show",E="startDateChange",K="strings",a0="template",aO="title",bk="tl",W="toolbar",bd="submit",bf="value",aL="visibleChange",T="when",ai="x",ah="y",ab="cancel",J="delete",w="edit",aE="save",bn="-",f=".",aa="",h="#",q=aF.IO.prototype._serialize,D=aF.getClassName,r=D(ac,bl),am=D(ac,bl,bm),bo=D(ac,bl,bm,g),v=D(ac,bl,bm,g,b),a8=D(ac,bl,bm,g,b,az),af=D(ac,bl,bm,g,aN),a1=D(ac,bl,bm,g,aB),ae=D(ac,bl,bm,g,aM),B=D(ac,bl,bm,g,ag),Q=D(ac,bl,bm,g,aA),bq=D(ac,bl,bm,g,x),an=D(ac,bl,bm,g,aI),C=D(ac,bl,aO),I=new aF.Template('<div class="',a8," ",v,'"></div>','<div class="',v,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bq,'">','<input class="',a1,'" name="content" value="{content}" />',"</div>",'<div class="',af,'">','<label class="',ae,'">{date}</label>','<select class="',an,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),V='<a class="'+B+'" href="javascript:;">{delete}</a>',bp='<form class="'+Q+'" id="schedulerEventRecorderForm"></form>';var S=aF.Component.create({NAME:ar,ATTRS:{content:{value:aa},duration:{value:60},dateFormat:{validator:bb,value:"%a, %B %d,"},event:{},strings:{value:{},setter:function(A){return aF.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:G},overlay:{validator:G,value:{align:{points:[bk,bk]},visible:false,width:260,zIndex:500}},overlayOffset:{value:[95,-31],validator:a},template:{value:I},toolbar:{setter:function(X){var L=this;var A=L.get(K);return aF.merge({children:[{handler:aF.bind(L._handleSaveEvent,L),label:A[aX]},{handler:aF.bind(L._handleCancelEvent,L),label:A[av]}]},X||{});},validator:G,value:{}}},EXTENDS:aF.SchedulerEvent,prototype:{initializer:function(){var A=this;A.publish(ab,{defaultFn:A._defCancelEventFn});A.publish(J,{defaultFn:A._defDeleteEventFn});A.publish(w,{defaultFn:A._defEditEventFn});A.publish(aE,{defaultFn:A._defSaveEventFn});A.after(l,A._afterSchedulerChange);A.on(E,A._onStartDateChange);A[g]=new aF.Overlay(A.get(g));A[W]=new aF.Toolbar(A.get(W));A.get(m).addClass(am);},_afterSchedulerChange:function(Y){var A=this;
var X=Y.newVal;var L=X.get(n);L.delegate(aV,aF.bind(A._onClickSchedulerEvent,A),f+r);},_defCancelEventFn:function(L){var A=this;A.get(m).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(ac);L.removeEvent(A.get(bl));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(ac);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(ac);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ab);L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bl)?w:aE,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickDelete:function(){var A=this;A.fire(J);},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(aq);if(L){A.set(bl,L);A.showOverlay();A.get(m).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bl)){var X=L[g].get(n);var A=X.one(f+a1);setTimeout(function(){A.selectText();},0);L.deleteNode.hide();}else{L.deleteNode.show();}}else{L.set(bl,null);L.get(m).remove();}},_onStartDateChange:function(L){var A=this;var X=A.get(aT);A.set(aJ,i.add(L.newVal,i.MINUTES,X));},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(K);L[g].render();L[W].render();var X=L[g].get(n);X.addClass(bo);L[g].set(y,L[W].get(n));L[g].on(aL,aF.bind(L._onOverlayVisibleChange,L));L.deleteNode=aF.Node.create(au.sub(V,{"delete":A[ag]}));L.deleteNode.on(aV,aF.bind(L._onClickDelete,L));X.append(L.deleteNode);L.formNode=aF.Node.create(bp);L.formNode.on(bd,aF.bind(L._onSubmitForm,L));L[g].set(aw,L.formNode);},getEventCopy:function(){var A=this;var X=A.get(bl);if(!X){X=new aF.SchedulerEvent({endDate:A.get(aJ),scheduler:A.get(ac),startDate:A.get(be)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aB,L[aB]);X.set(aI,L[aI]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aC);var br=(X.get(bl)||X);var bt=br.get(aJ);var bs=br.get(ac);var A=br.get(be);var Y=(bs.get(N).get(aQ)?i.toIsoTimeString:i.toUsTimeString);return[br._formatDate(A,L),Y(A),a7,Y(bt)].join(p);},hideOverlay:function(){var A=this;A[g].hide();},populateForm:function(){var L=this;var A=L.get(K);if(!L.eventRepeatArray){L.eventRepeatArray=[];aF.each(aF.SchedulerEventRepeat,function(Y){L.eventRepeatArray.push({description:Y[a3],value:Y[bf]});});}var X=(L.get(bl)||L);L.formNode.setContent(L.get(a0).parse({content:X.get(aB)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aJ),eventRepeat:L.eventRepeatArray,repeat:X.get(aI),startDate:X.get(be)}));},serializeForm:function(){var A=this;return aF.QueryString.parse(q(A.formNode.getDOM()));},showOverlay:function(X,Y){var A=this;if(!A[g].get(bj)){A._renderOverlay();}A[g].show();if(!X){var L=(A.get(bl)||A).get(m);X=L.one(f+C);}A[g].set("align.node",X);Y=Y||A.get(P);A[g].move(A[g].get(ai)+Y[0],A[g].get(ah)+Y[1]);}}});aF.SchedulerEventRecorder=S;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});