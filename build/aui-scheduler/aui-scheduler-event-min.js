AUI.add("aui-scheduler-event",function(aL){var ao=aL.Lang,bk=ao.isString,f=ao.isDate,ba=ao.isFunction,G=ao.isObject,bd=ao.isBoolean,ae=ao.isNumber,aZ=aL.ColorUtil,j=aL.DataType.DateMath,a6=aL.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bf="-",t="&ndash;",az=".",p="",q=" ",l="_",aN="_propagateSet",Q="activeView",T="borderColor",aP="borderColorRGB",aJ="borderStyle",br="borderWidth",I="Change",a4="color",aX="colorBrightnessFactor",be="colorSaturationFactor",aH="content",w="disabled",a1="duration",aQ="endDate",aT="eventClass",ar="eventStack",bl="events",av="hidden",H="hsbColor",au="icon",ab="icons",a2="id",aY="isoTime",bq="locale",a0="never",n="node",h="overlay",aM="parentEvent",bw="recorder",aO="repeat",bj="repeated",P="repeatedEvents",bc="repeater",ah="scheduler",aw="scheduler-event",ay="scheduler-event-recorder",bn="startDate",a8="template",aW="title",e="titleDateFormat",ap="visible",d="%H:%M",a7="%I:%M",E=aL.getClassName,k=E(au),s=E(aw),aR=E(aw,aH),C=E(aw,av),bh=E(aw,w),aq=E(aw,bw),aC=E(aw,bj),an=E(aw,bc),D=E(aw,aW),bp=E(aw,ab),v=E(aw,au,w),b=E(aw,au,bj),bt=E(aw,au,bc);var V=aL.Component.create({NAME:aw,ATTRS:{allDay:{value:false,validator:bd},borderStyle:{value:"solid",validator:bk},borderWidth:{value:"1px",validator:bk},colorBrightnessFactor:{value:0.75,validator:ae},colorSaturationFactor:{value:1.5,validator:ae},content:{value:"(no title)",validator:bk},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bk},titleDateFormat:{getter:"_getTitleDateFormat",validator:bk},endDate:{setter:"_setDate",valueFn:function(){var A=j.clone(this.get(bn));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aL.SchedulerEvent;}},disabled:{value:false,validator:bd},node:{valueFn:function(){return aL.NodeList.create(aL.Node.create(this.EVENT_NODE_TEMPLATE).setData(aw,this));}},parentEvent:{},repeat:{value:p,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:bd}},EXTENDS:aL.Base,PROPAGATE_ATTRS:[bn,aQ,aH,a4,aX,be,aJ,br,e,ap,w],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+s+'">'+'<div class="'+D+'"></div>'+'<div class="'+aR+'"></div>'+'<div class="'+bp+'">'+'<span class="'+[k,b].join(q)+'"></span>'+'<span class="'+[k,bt].join(q)+'"></span>'+'<span class="'+[k,v].join(q)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var L=A.get(n);A[ar]={};aL.Array.each(A.get(aT).PROPAGATE_ATTRS,function(X){A.after(X+I,A._propagateAttrChange);});A._bindUIAttrs();A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[ar]={};A.get(n).remove(true);},addPaddingNode:function(){var A=this;A.get(n).push(aL.Node.create(A.EVENT_NODE_TEMPLATE).setData(aw,A));A.syncNodeUI();},copyDates:function(L){var A=this;A.set(aQ,j.clone(L.get(aQ)));A.set(bn,j.clone(L.get(bn)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aL.Array.each(A.get(aT).PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var bB=L.get(Y);if(!G(bB)){A.set(Y,bB);}}});},getBorderColor:function(){var A=this;return A[aP].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aQ),A.get(bn));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aQ),A.get(bn));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aQ),A.get(bn));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aQ),A.get(bn));},sameEndDate:function(L){var A=this;return j.compare(A.get(aQ),L.get(aQ));},sameStartDate:function(L){var A=this;return j.compare(A.get(bn),L.get(bn));},isAfter:function(Y){var X=this;var L=X.get(bn);var A=Y.get(bn);return j.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(bn);var A=Y.get(bn);return j.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[ar][Y]){var A=j.clone(X);var bC=j.clone(X);j.copyHours(A,L.get(bn));j.copyHours(bC,L.get(aQ));var bB=new L.get(aT)({endDate:bC,parentEvent:L,scheduler:L.get(ah),startDate:A});bB.copyPropagateAttrValues(L);L[ar][Y]=bB;}return L[ar][Y];},intersects:function(Y){var X=this;var bB=X.get(aQ);var L=X.get(bn);var A=Y.get(bn);return(X.sameStartDate(Y)||j.between(A,L,bB));},intersectHours:function(X){var L=this;var bB=L.get(aQ);var A=L.get(bn);var Y=j.clone(A);j.copyHours(Y,X.get(bn));return(j.compare(A,Y)||j.between(Y,A,bB));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(bn),A.get(aQ));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(bn),A.get(aQ));},isRepeatableDate:function(L){var A=this;var X=A.get(aO);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aQ));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(bn));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(bn,L);A.set(aQ,j.add(j.clone(L),j.MINUTES,X));},uidByDate:function(L){var A=this;L=f(L)?j.safeClearTime(L):A.getClearStartDate();return[aw,L.getTime()].join(l);},setContent:function(X,L){var A=this;A.get(n).each(function(bB){var Y=bB.one(g+aR);Y.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bB){Y.setContent(X);});}},setTitle:function(X,L){var A=this;A.get(n).each(function(Y){var bB=Y.one(g+D);bB.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bB){Y.setTitle(X);});}},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var Y=A.get(n);var bB=A.getBorderColor();if(Y){var X={borderWidth:A.get(br),borderColor:bB,backgroundColor:A.get(a4),borderStyle:A.get(aJ)};Y.setStyles(X);}if(L){A.eachRepeatedEvent(function(bC,bD){bC.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aH),L);},syncNodeTitleUI:function(L){var A=this;var Y=A._formatDate(A.get(bn));var X=A._formatDate(A.get(aQ));A.setTitle([Y,X].join(q+t+q),L);},split:function(){var A=this,X=j.clone(A.get(bn)),Y=j.clone(A.get(aQ));
if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(X);L.setHours(24,0,0,0);return[[X,j.toMidnight(j.clone(X))],[L,j.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aL.each(A[ar],L,A);},unlink:function(){var A=this;if(A.get(aM)){A.set(aM,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[ar]={};A.syncNodeUI();},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({disabledChange:A._afterDisabledChange,visibleChange:A._afterVisibleChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(bB,bC){var bD=bB[aN+a6(X)];if(bD){bD.apply(A,[bB,X,L]);}else{bB.set(X,Y.newVal);}bB.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=j.clone(A.get(aQ));j.copyHours(X,Y);A.set(aQ,X);},_propagateSetStartDate:function(L,X,Y){var A=j.clone(L.get(bn));j.copyHours(A,Y);L.set(bn,A);},_setColor:function(L){var A=this;A[H]=aZ.rgb2hsb(aZ.getRGB(L));A[T]=aL.clone(A[H]);A[T].b*=A.get(aX);A[T].s*=A.get(be);A[aP]=aZ.hsb2rgb(A[T]);return L;},_setDate:function(L){var A=this;if(ae(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(bk(L)){L=aL.SchedulerEventRepeat[L];}return G(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(ah);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(w));A._uiSetVisible(A.get(ap));A._uiSetParentEvent(A.get(aM));A._uiSetRepeat(A.get(aO));},_formatDate:function(X,Y){var L=this;var A=L.get(bq);Y=Y||L.get(e);return aL.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(X){var A=this;if(!bk(X)){var L=A.get(ah);X=(L&&L.get(Q).get(aY))?d:a7;}return X;},_uiSetDisabled:function(L){var A=this;A.get(n).toggleClass(bh,!!L);},_uiSetParentEvent:function(L){var A=this;A.get(n).toggleClass(aC,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aL.SchedulerEventRepeat[a0];A.get(n).toggleClass(an,L);},_uiSetVisible:function(L){var A=this;A.get(n).toggleClass(C,!L);}}});aL.SchedulerEvent=V;aL.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aQ);var A=L.get(bn);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return j.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return j.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return j.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aQ);var A=L.get(bn);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aQ);var A=L.get(bn);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var ax=aL.Lang,a=ax.isArray,G=ax.isObject,Q="activeView",J="allDay",c="arrow",aV="body",aB="bodyContent",o="boundingBox",aA="cancel",a3="click",aH="content",aU="date",aI="dateFormat",ak="delete",bb="description",R="edit",bv="event",aT="eventClass",B="footerContent",aF="form",z="header",u="hide",aY="isoTime",aG="link",n="node",O="offsetHeight",bi="offsetWidth",h="overlay",S="overlayOffset",bw="recorder",bs="rendered",aO="repeat",a5="save",ah="scheduler",m="schedulerChange",aw="scheduler-event",ay="scheduler-event-recorder",aE="shadow",aD="show",F="startDateChange",N="strings",a8="template",aW="title",bu="tl",ad="toolbar",bm="submit",bo="value",aS="visibleChange",aa="when",am="x",al="y",ag="cancel",M="delete",y="edit",aK="save",bx="-",g=".",af="",i="#",r=aL.IO.prototype._serialize,E=aL.getClassName,s=E(ah,bv),aq=E(ah,bv,bw),by=E(ah,bv,bw,h),x=E(ah,bv,bw,h,c),bg=E(ah,bv,bw,h,c,aE),aj=E(ah,bv,bw,h,aV),a9=E(ah,bv,bw,h,aH),ai=E(ah,bv,bw,h,aU),U=E(ah,bv,bw,h,aF),bA=E(ah,bv,bw,h,z),W=E(ah,bv,bw,h,aG),at=E(ah,bv,bw,h,aO),D=E(ah,bv,aW),K=new aL.Template('<div class="',bg," ",x,'"></div>','<div class="',x,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bA,'">','<input class="',a9,'" name="content" value="{content}" />',"</div>",'<div class="',aj,'">','<label class="',ai,'">{date}</label>','<select class="',at,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),ac='<a class="'+W+'" href="javascript:;">{delete}</a>',bz='<form class="'+U+'" id="schedulerEventRecorderForm"></form>';var Z=aL.Component.create({NAME:ay,ATTRS:{allDay:{value:false},content:{value:af},duration:{value:60},dateFormat:{validator:bk,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aL.SchedulerEvent;}},strings:{value:{},setter:function(A){return aL.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:G},overlay:{validator:G,value:{align:{points:[bu,bu]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:a},template:{value:K},toolbar:{setter:function(X){var L=this;var A=L.get(N);return aL.merge({children:[{handler:aL.bind(L._handleSaveEvent,L),label:A[a5]},{handler:aL.bind(L._handleCancelEvent,L),label:A[aA]}]},X||{});
},validator:G,value:{}}},EXTENDS:aL.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(n).addClass(aq);A.publish(ag,{defaultFn:A._defCancelEventFn});A.publish(M,{defaultFn:A._defDeleteEventFn});A.publish(y,{defaultFn:A._defEditEventFn});A.publish(aK,{defaultFn:A._defSaveEventFn});A.after(m,A._afterSchedulerChange);A[h]=new aL.Overlay(A.get(h));A[ad]=new aL.Toolbar(A.get(ad));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(o);L.delegate(a3,aL.bind(A._onClickSchedulerEvent,A),g+s);},_defCancelEventFn:function(L){var A=this;A.get(n).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(ah);L.removeEvent(A.get(bv));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(ah);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(ah);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ag);L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bv)?y:aK,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickDelete:function(){var A=this;A.fire(M,{schedulerEvent:A.get(bv)});},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(aw);if(L){A.set(bv,L);A.showOverlay([X.pageX,X.pageY]);A.get(n).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bv)){var X=L[h].get(o);var A=X.one(g+a9);setTimeout(function(){A.selectText();},0);L.deleteNode.hide();}else{L.deleteNode.show();}}else{L.set(bv,null);L.get(n).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(N);L[h].render();L[ad].render();var X=L[h].get(o);X.addClass(by);L[h].set(B,L[ad].get(o));L[h].on(aS,aL.bind(L._onOverlayVisibleChange,L));L.deleteNode=aL.Node.create(ax.sub(ac,{"delete":A[ak]}));L[h].footerNode.append(L.deleteNode);L.formNode=aL.Node.create(bz);L[h].set(aB,L.formNode);L.deleteNode.on(a3,aL.bind(L._onClickDelete,L));L.formNode.on(bm,aL.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var X=A.get(bv);if(!X){X=new (A.get(aT))({allDay:A.get(J),endDate:A.get(aQ),scheduler:A.get(ah),startDate:A.get(bn)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aH,L[aH]);X.set(aO,L[aO]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aI);var bB=(X.get(bv)||X);var bD=bB.get(aQ);var bC=bB.get(ah);var A=bB.get(bn);var Y=(bC.get(Q).get(aY)?j.toIsoTimeString:j.toUsTimeString);return[bB._formatDate(A,L),Y(A),bf,Y(bD)].join(q);},getTemplateData:function(){var L=this;var A=L.get(N);var X=(L.get(bv)||L);return{content:X.get(aH)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aQ).getTime(),eventRepeat:L.eventRepeatArray,repeat:X.get(aO),startDate:X.get(bn).getTime()};},hideOverlay:function(){var A=this;A[h].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aL.each(aL.SchedulerEventRepeat,function(L){A.eventRepeatArray.push({description:L[bb],value:L[bo]});});}A.formNode.setContent(A.get(a8).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aL.QueryString.parse(r(A.formNode.getDOM()));},showOverlay:function(Y,bC){var A=this;var X=A.get(S);if(!A[h].get(bs)){A._renderOverlay();}A[h].show();if(!Y){var L=(A.get(bv)||A).get(n);var bB=L.one(g+D);bC=[X[0]+bB.get(bi),X[1]+bB.get(O)/2];Y=bB.getXY();}bC=bC||X;Y[0]+=bC[0];Y[1]+=bC[1];A[h].set("xy",Y);}}});aL.SchedulerEventRecorder=Z;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});